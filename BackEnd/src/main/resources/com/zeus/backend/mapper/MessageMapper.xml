<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zeus.backend.mapper.MessageMapper">
	<!-- 메시지 삽입 -->
	<insert id="create" >
		INSERT INTO messages (
		message_id, sender_id, sender_nickname, receiver_id, receiver_nickname, content
		) VALUES (
		message_id_seq.NEXTVAL, #{sender_id}, #{sender_nickname}, #{receiver_id}, #{receiver_nickname}, #{content}
		)
	</insert>
	<!-- 특정 사용자의 쪽지 목록 조회 -->
	<select id="findByUserId" resultType="com.zeus.backend.domain.Message">
		SELECT * FROM messages WHERE receiver_id = #{receiver_id} ORDER BY sent_at DESC
	</select>
	<!-- 특정 사용자의 특정 보낸이로부터 쪽지 목록 조회 -->
	<select id="findByReceiverId" resultType="com.zeus.backend.domain.Message">
		SELECT * FROM messages WHERE receiver_id = #{receiver_id} and sender_id = #{sender_id}
		ORDER BY sent_at DESC
	</select>
	<!-- 쪽지를 읽음 상태로 업데이트 -->
	<update id="updateRead">
		UPDATE messages SET is_read = 1 WHERE message_id = #{message_id}
	</update>
	<!-- 쪽지 삭제 -->
    <delete id="deleteById" >
        DELETE FROM messages WHERE message_id = #{message_id}
    </delete>
    <!-- 특정 사용자가 받은 모든 쪽지 삭제 -->
    <delete id="deleteByReceiverId" >
        DELETE FROM messages WHERE receiver_id = #{receiver_id}
    </delete>
</mapper>